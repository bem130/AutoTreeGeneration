<!DOCTYPE html>
<html>
    <head>
    </head>
    <body>
        <canvas id="out"></canvas>
    </body>
</html>
<script>

const size = [1500,800]

const cnv = document.querySelector("#out");
const ctx = cnv.getContext("2d");

function lengthN(param,n,i) {
    return param.RootLen*(param.Ps**(n-1))*(param.Psi**(i-1));
}
function radiusN(param,n,i) {
    return param.RootRad*(param.Prs**(n-1))*(param.Prsi**(i-1));
}
function newAngle(param,n,i) {
    return (Math.random()-0.5)*param.RootAngle*(param.Pa**(n-1))*(param.Pai**(i-1));
}

function rnd(min,max) {
    return Math.random()*(max-min)+min;
}

function rotateVec(vec,angle) {
    return [
        vec[0]*Math.cos(angle)-vec[1]*Math.sin(angle),
        vec[0]*Math.sin(angle)+vec[1]*Math.cos(angle),
    ];
}
function scaleVec(vec,scale) {
    return [vec[0]*scale,vec[1]*scale];
}
function addVec(a,b) {
    console.log(a,b)
    return [a[0]+b[0],a[1]+b[1]];
}

cnv.width = size[0];
cnv.height = size[1];
start();
function start() {
    for (let i=0;i<8;i++) {
        const param = {
            RootLen: 150, // 長さの基準
            RootRad: 5, // 太さの基準
            RootAngle: 0.8, // 傾きの基準
            Ps: 0.6, // 長さの比 世代間
            Psi: 0.6, // 長さの比 兄弟間
            Prs: 0.7, // 太さの比 世代間
            Prsi: 0.8, // 太さの比 兄弟間
            Pa: 1.2, // 角度の比 世代間
            Pai: 1.5, // 角度の比 兄弟間
            branchColor: [[0,20],[25,40],[15,25]], // 枝の色
            leafColor: [[80,120],[20,40],[1,40]], // 葉の色
        }
        newBranch(param,9,1,[0,1],[rnd(0+50,size[0]-50),size[1]]);
    }
}
function newBranch(param,max,n,vec,startPos,I=1) {
    for (let i=0;i<I;i++) {
        const nangle = rotateVec(vec,newAngle(param,n,i));
        const npos = addVec(startPos,scaleVec(nangle,-lengthN(param,n,i)));
        if (n<max) {
            newBranch(param,max,n+1,nangle,npos,Math.random()*2+2);
        }
        ctx.lineWidth = radiusN(param,n,i);
        if (n<7) {
            ctx.strokeStyle = `hsl(${rnd(...param.branchColor[0])},${rnd(...param.branchColor[1])}%,${rnd(...param.branchColor[2])}%)`;
        }
        else {
            ctx.strokeStyle = `hsl(${rnd(...param.leafColor[0])},${rnd(...param.leafColor[1])}%,${rnd(...param.leafColor[2])}%)`;
        }
        ctx.beginPath();
        ctx.moveTo(...startPos);
        ctx.lineTo(...npos);
        ctx.stroke();
    }
}

</script>
<style>

:root {
    color-scheme: dark;
}

#out {
    background-color: white;
    border: 1px solid;
}

</style>