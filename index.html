<!DOCTYPE html>
<html>
    <head>
    </head>
    <body>
        <canvas id="out"></canvas>
    </body>
</html>
<script>

const size = [1500,800]

const cnv = document.querySelector("#out");
const ctx = cnv.getContext("2d");

const RootLen = 150; // 長さの基準
const RootRad = 5; // 太さの基準
const RootAngle = 0.8; // 傾きの基準
const Ps = 0.6; // 長さの比 世代間
const Psi = 0.7; // 長さの比 兄弟間
const Prs = 0.7; // 太さの比 世代間
const Prsi = 0.8; // 太さの比 兄弟間
const Pa = 1.2; // 角度の比 世代間
const Pai = 1.5; // 角度の比 兄弟間
const branchColor = [[0,20],[25,40],[15,25]]; // 枝の色
const leafColor = [[80,120],[20,40],[1,40]]; // 葉の色

function lengthN(n,i) {
    return RootLen*(Ps**(n-1))*(Psi**(i-1));
}
function radiusN(n,i) {
    return RootRad*(Prs**(n-1))*(Prsi**(i-1));
}
function newAngle(n,i) {
    return (Math.random()-0.5)*RootAngle*(Pa**(n-1))*(Pai**(i-1));
}

function rnd(min,max) {
    return Math.random()*(max-min)+min;
}

function rotateVec(vec,angle) {
    return [
        vec[0]*Math.cos(angle)-vec[1]*Math.sin(angle),
        vec[0]*Math.sin(angle)+vec[1]*Math.cos(angle),
    ];
}
function scaleVec(vec,scale) {
    return [vec[0]*scale,vec[1]*scale];
}
function addVec(a,b) {
    console.log(a,b)
    return [a[0]+b[0],a[1]+b[1]];
}

cnv.width = size[0];
cnv.height = size[1];
start();
function start() {
    for (let i=0;i<8;i++) {
        newBranch(10,1,[0,1],[rnd(0+50,size[0]-50),size[1]]);
    }
}
function newBranch(max,n,vec,startPos,I=1) {
    for (let i=0;i<I;i++) {
        const nangle = rotateVec(vec,newAngle(n,i));
        const npos = addVec(startPos,scaleVec(nangle,-lengthN(n,i)));
        if (n<max) {
            newBranch(max,n+1,nangle,npos,Math.random()*2+2);
        }
        ctx.lineWidth = radiusN(n,i);
        if (n<7) {
            ctx.strokeStyle = `hsl(${rnd(...branchColor[0])},${rnd(...branchColor[1])}%,${rnd(...branchColor[2])}%)`;
        }
        else {
            ctx.strokeStyle = `hsl(${rnd(...leafColor[0])},${rnd(...leafColor[1])}%,${rnd(...leafColor[2])}%)`;
        }
        ctx.beginPath();
        ctx.moveTo(...startPos);
        ctx.lineTo(...npos);
        ctx.stroke();
    }
}

</script>
<style>

:root {
    color-scheme: dark;
}

#out {
    background-color: white;
    border: 1px solid;
}

</style>